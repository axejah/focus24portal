<%- include('../../../../../includes/header.ejs') %>
<%- include('../../../../../includes/navigation.ejs') %>

<div class="container">
  <header class="mt-5 mb-5">
    <h3>Bedrijven Wizard</h3>
    <a href="/portal/customers/" class="btn btn-danger">Annuleren</a>
  </header>
  <form action="/portal/customers/wizard/actie" method="POST" class="needs-validation" novalidate>
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
    <ul class="nav nav-tabs" id="wizardTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="bedrijven-tab" data-bs-toggle="tab" data-bs-target="#bedrijfsgegevens"
          type="button" role="tab" aria-controls="bedrijfsgegevens" aria-selected="true">Bedrijfsgegevens</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact" type="button"
          role="tab" aria-controls="contactpersoon" aria-selected="false">Contactgegevens</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="action-tab" data-bs-toggle="tab" data-bs-target="#action" type="button" role="tab"
          aria-controls="actie" aria-selected="false">Actie</button>
      </li>
    </ul>
    <div class="tab-content" id="wizardTabContent">
      <!--BEDRIJFSGEGEVENS TAB-->
      <div class="tab-pane fade show active" id="bedrijfsgegevens" role="tabpanel"
        aria-labelledby="bedrijfsgegevens-tab">
        <% if(typeof errorMessage == "undefined"){ %>

        <% } else { %>
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <%= errorMessage  %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <%}%>
          <h5 class="p-3">Algemene bedrijfsgegevens</h5>
          <div class="input-group mb-3">
            <span class="input-group-text" id="bedrijfsnaam" required>Bedrijfsnaam <span style="color: red;">*</span></span>
            <input type="text" class="form-control" id="bedrijfsnaam_comp" placeholder="Bedrijfsnaam" aria-label="bedrijfsnaam" name="bedrijfsnaam"
              aria-describedby="bedrijfsnaam" required>
              <div class="invalid-feedback">
                Vul een bedrijfsnaam in.
              </div>
          </div>
          <div class="input-group mb-3">
            <span class="input-group-text" id="kvk_nummer">KvK-nummer</span>
            <input type="text" class="form-control" placeholder="KvK-nummer" aria-label="kvk_nummer" name="kvk_nummer"
              aria-describedby="kvk_nummer">
          </div>
          <div class="input-group mb-3">
            <span class="input-group-text" id="telefoonnummer1" required>Telefoonnummer 1 <span style="color: red;">*</span></span>
            <input type="text" class="form-control" id="telefoonnummer_comp" placeholder="Telefoonnummer 1" name="telefoonnummer1" aria-label="telefoonnummer1"
              name="telefoonnummer1" aria-describedby="telefoonnummer1" required>
              <div class="invalid-feedback">
                Vul een telefoonnummer in.
              </div>
          </div>
          <div class="input-group mb-3">
            <span class="input-group-text" id="telefoonnummer2">Telefoonnummer 2</span>
            <input type="text" class="form-control" placeholder="Telefoonnummer 2" aria-label="telefoonnummer2"
              name="telefoonnummer2" aria-describedby="telefoonnummer2">
          </div>
          <div class="input-group mb-3">
            <span class="input-group-text" id="email" required>E-mailadres <span style="color: red;">*</span></span>
            <input type="email" class="form-control" placeholder="E-mailadres" aria-label="email_comp" name="email_comp"
              aria-describedby="email" id="email_comp" required>
              <div class="invalid-feedback">
                Vul een emailadres in.
              </div>
          </div>
          <h5 class="mt-3 p-3">Adresinfo</h5>
          <div class="input-group mb-3">
            <span class="input-group-text" id="straat">Straat</span>
            <input type="text" class="form-control" placeholder="Straat" aria-label="straat" name="straat"
              aria-describedby="straat">
          </div>
          <div class="input-group mb-3">
            <span class="input-group-text" id="huisnummer">Huisnummer</span>
            <input type="text" class="form-control" placeholder="Huisnummer" aria-label="huisnummer" name="huisnummer"
              aria-describedby="huisnummer">
          </div>
          <div class="input-group mb-3">
            <span class="input-group-text" id="postcode">Postcode</span>
            <input type="text" class="form-control" placeholder="Postcode" aria-label="postcode" name="postcode"
              aria-describedby="postcode">
          </div>
          <div class="input-group mb-3">
            <span class="input-group-text" id="plaats">Plaats</span>
            <input type="text" class="form-control" placeholder="Plaats" aria-label="plaats" name="plaats"
              aria-describedby="plaats">
          </div>
          <div class="row p-3">

            <div class="col">
              <button id="next-btn" class="btn btn-primary">Volgende</button>
            </div>
          </div>
      </div>
      <!--CONTACT TAB-->
      <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
        <h5 class="p-3">Contactgegevens</h5>
        <div class="input-group mb-3">
          <span class="input-group-text" id="voornaam">Voornaam <span style="color: red;">*</span></span>
          <input type="text" class="form-control" placeholder="Voornaam" aria-label="voornaam" id="voornaam_cp" name="voornaam"
            aria-describedby="voornaam" required>
            <div class="invalid-feedback">
              Vul een voornaam in.
            </div>
        </div>
        <div class="input-group mb-3">
          <span class="input-group-text" id="achternaam">Achternaam <span style="color: red;">*</span></span>
          <input type="text" class="form-control" placeholder="Achternaam" aria-label="achternaam" id="achternaam_cp" name="achternaam"
            aria-describedby="achternaam" required>
            <div class="invalid-feedback">
              Vul een achternaam in.
            </div>
        </div>
        <div class="input-group mb-3">
          <label class="input-group-text" for="inputGroupSelect01">Geslacht</label>
          <select class="form-select" id="inputGroupSelect01" name="geslacht">
            <option value="" selected>Geslacht...</option>
            <option value="Man">Man</option>
            <option value="Vrouw">Vrouw</option>
            <option value="Onbekend">Onbekend</option>
          </select>
        </div>
        <div class="input-group mb-3">
          <span class="input-group-text" id="telefoonnummer1">Telefoonnummer 1 <span style="color: red;">*</span></span>
          <input type="text" class="form-control" placeholder="Telefoonnummer 1" id="telefoonnummer1_cp" aria-label="telefoonnummer1"
            name="telefoonnummer1_cp" aria-describedby="telefoonnummer1" required>
            <div class="invalid-feedback">
              Vul een telefoonnummer in.
            </div>
        </div>
        <div class="input-group mb-3">
          <span class="input-group-text" id="telefoonnummer2">Telefoonnummer 2</span>
          <input type="text" class="form-control" placeholder="Telefoonnummer 2" aria-label="telefoonnummer2"
            name="telefoonnummer2_cp" aria-describedby="telefoonnummer2">
        </div>
        <div class="input-group mb-3">
          <span class="input-group-text" id="emailadres">E-mailadres <span style="color: red;">*</span></span>
          <input type="email" class="form-control" placeholder="E-mailadres" aria-label="emailadres" id="emailadres_cp" name="emailadres"
            aria-describedby="emailadres" required>
            <div class="invalid-feedback">
              Vul een emailadres in.
            </div>
        </div>
        <div class="input-group mb-3">
          <span class="input-group-text" id="functie">Functie</span>
          <input type="text" class="form-control" placeholder="Functie" aria-label="functie" name="functie"
            aria-describedby="functie">
        </div>
        <div class="input-group mb-3">
          <label class="input-group-text" for="inputGroupSelect02">Beslissingsbevoegd</label>
          <select class="form-select" id="inputGroupSelect02" name="beslissingsbevoegd">
            <option value="0" selected>Nee</option>
            <option value="1">Ja</option>
          </select>
        </div>
        <div class="input-group mb-3">
          <span class="input-group-text">Opmerkingen</span>
          <textarea class="form-control" name="remarks" aria-label="Opmerkingen"></textarea>
        </div>

        <div class="row p-3">

          <div class="col">
            <button id="prev-btn" class="btn btn-primary">Vorige</button>
            <button id="next-btn2" class="btn btn-primary">Volgende</button>
          </div>
        </div>
      </div>
      <!--ACTION TAB-->
      <div class="tab-pane fade" id="action" role="tabpanel" aria-labelledby="action-tab">
        <h5 class="p-3">Actie toevoegen</h5>
        <div class="form-check form-switch mt-3 mb-3">
          <input class="form-check-input" type="checkbox" name="actie_switch" id="actieSwitch">
          <label class="form-check-label" for="actieSwitch">Actie toevoegen</label>
        </div>
        <div id="actievelden" style="display: none;">
       
          <div class="input-group mb-3">
            <label class="input-group-text" for="user">Owner</label>
            <select class="form-select" id="user" name="owner">
              <% for(let y = 0; y < owners.length; y++) {
                let selected = (owners[y].voornaam === user.voornaam) ? "selected" : "";
                %><option value="<%= owners[y].voornaam%>" <%= selected %>><%= owners[y].voornaam %></option>
        <%}%> 
            </select>
            <div class="invalid-feedback">
              Vul een owner in.
            </div>
          </div>
        
          <div class="input-group mb-3">
          <label class="input-group-text" for="status">Status</label>
          <select class="form-select" id="status" name="status">
            <option value="">Kies een status</option>
            <option value="Open">Open</option>
            <option value="On-Hold">On-Hold</option>
            <option value="Closed">Closed</option>
          </select>
          <div class="invalid-feedback">
            Vul een status in.
          </div>
        </div>
        <div class="input-group mb-3">
          <span class="input-group-text">Actie</span>
          <textarea name="actie" class="form-control" aria-label="Actie"
            placeholder="E.g. telefoongesprek gevoerd, e-mail gestuurd, etc." id="actie"></textarea>
        </div>
        <div class="input-group mb-3">
          <span class="input-group-text" id="followup_date_desc">Follow-up datum</span>
          <input type="date" id="followup_date" class="form-control" name="follow_up"
            placeholder="Voer een datum en tijd in" aria-label="follow-up"
            aria-describedby="followup_date_desc">
          <input type="time" id="followup_time" class="form-control" placeholder="tijdstip" name="follow_up_time"
            aria-label="time">
        </div>
      </div>
      <div class="row p-3">
      <div class="col">
        <button id="prev-btn2" class="btn btn-primary">Vorige</button>
      </div>
      <div class="col">
        <button type="submit" class="btn btn-success">Opslaan</button>
      </div>
    </div>
  </div>
      </div>
  </form>

</div>

<script>
document.getElementById('next-btn').addEventListener('click', nextTab);
document.getElementById('prev-btn').addEventListener('click', prevTab);
document.getElementById('next-btn2').addEventListener('click', nextTab2);
document.getElementById('prev-btn2').addEventListener('click', prevTab2);


const actionSwitch = document.getElementById('actieSwitch');
const actionFields = document.getElementById('actievelden');
actionSwitch.addEventListener('click', showAction);


function showAction() {

  const status = document.getElementById('status')
  const actie = document.getElementById('actie')
  const followup_date = document.getElementById('followup_date')
  const followup_time = document.getElementById('followup_time')

  if(actionSwitch.checked) {
    actionFields.style.display = 'block';
    status.setAttribute('required', true);
    actie.setAttribute('required', true);
  } else {
    actionFields.style.display = 'none';
    status.setAttribute('required', false);
    actie.setAttribute('required', false);
  }
}

  function nextTab(e) {
    e.preventDefault();

    const bedrijfsnaam = document.getElementById('bedrijfsnaam_comp');
    const telefoonnummer = document.getElementById('telefoonnummer_comp');
    const emailadres = document.getElementById('email_comp');

      if(bedrijfsnaam.value && telefoonnummer.value && emailadres.value) {
        emailadres.classList.remove('is-invalid') && emailadres.classList.add('is-valid');
        telefoonnummer.classList.remove('is-invalid') && telefoonnummer.classList.add('is-valid');
        bedrijfsnaam.classList.remove('is-invalid') && bedrijfsnaam.classList.add('is-valid');
        const contactTab = document.getElementById('contact-tab');
         const tab = new bootstrap.Tab(contactTab);
        tab.show();
      } else {
      !bedrijfsnaam.value ? bedrijfsnaam.classList.add('is-invalid') : bedrijfsnaam.classList.remove('is-invalid') && bedrijfsnaam.classList.add('is-valid');
      !telefoonnummer.value ? telefoonnummer.classList.add('is-invalid') : telefoonnummer.classList.remove('is-invalid') && telefoonnummer.classList.add('is-valid');
      !emailadres.value ? emailadres.classList.add('is-invalid') : emailadres.classList.remove('is-invalid') && emailadres.classList.add('is-valid');
    }
  }

  function nextTab2(e) {
    e.preventDefault();

    const voornaam = document.getElementById('voornaam_cp');
    const achternaam = document.getElementById('achternaam_cp');
    const telefoonnummer1 = document.getElementById('telefoonnummer1_cp');
    const emailadres = document.getElementById('emailadres_cp');

      if(voornaam.value && telefoonnummer1.value && emailadres.value) {
        emailadres.classList.remove('is-invalid') && emailadres.classList.add('is-valid');
        telefoonnummer1.classList.remove('is-invalid') && telefoonnummer1.classList.add('is-valid');
        voornaam.classList.remove('is-invalid') && voornaam.classList.add('is-valid');
	      achternaam.classList.remove('is-invalid') && achternaam.classList.add('is-valid');

        const actionTab = document.getElementById('action-tab');
         const tab = new bootstrap.Tab(actionTab);
        tab.show();
      } else {
      !voornaam.value ? voornaam.classList.add('is-invalid') : voornaam.classList.remove('is-invalid') && voornaam.classList.add('is-valid');
	    !achternaam.value ? achternaam.classList.add('is-invalid') : achternaam.classList.remove('is-invalid') && achternaam.classList.add('is-valid');
      !telefoonnummer1.value ? telefoonnummer1.classList.add('is-invalid') : telefoonnummer1.classList.remove('is-invalid') && telefoonnummer1.classList.add('is-valid');
      !emailadres.value ? emailadres.classList.add('is-invalid') : emailadres.classList.remove('is-invalid') && emailadres.classList.add('is-valid');
    }
  }

  function prevTab(e) {
    e.preventDefault();
    const bedrijvenTab = document.getElementById('bedrijven-tab');
    const tab = new bootstrap.Tab(bedrijvenTab);
    tab.show();
  }

  function prevTab2(e) {
    e.preventDefault();
    const contactTab = document.getElementById('contact-tab');
    const tab = new bootstrap.Tab(contactTab);
    tab.show();
  }

  (function () {
  'use strict'

  // Fetch all the forms we want to apply custom Bootstrap validation styles to
  var forms = document.querySelectorAll('.needs-validation')

  // Loop over them and prevent submission
  Array.prototype.slice.call(forms)
    .forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }

        form.classList.add('was-validated')
      }, false)
    })
})()

</script>
<%- include('../../../../../includes/footer.ejs') %>